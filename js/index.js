// Generated by CoffeeScript 1.12.7
var Bakudaniwa, BakudaniwaBase, Cell, CharacterBase, CharacterPalletManager, EnemyBase, EnvManager, FieldManager, GameManager, HondaMio, HondaMioBase, InfoManager, Keruberosu, KeruberosuBase, LeftInfoManager, LevelupController, LevelupManager, LevelupPanel, Majisuko, MajisukoBase, Meatball, MeatballBase, MenuManager, ObjectBase, Panel, PixyFox, PixyFoxBase, RightInfoManager, ShibuyaRin, ShibuyaRinBase, SimamuraUduki, SimamuraUdukiBase, Utl,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

ObjectBase = (function() {
  ObjectBase.OBJECT_TYPE = {
    CHARACTER: 'CHARACTER',
    ENEMY: 'ENEMY'
  };

  ObjectBase.ATTACK_TYPE = {
    PHYSIC: '物理',
    MAGIC: '魔法'
  };

  ObjectBase.DAMAGE_SHAKE_RATE = 0.1;

  ObjectBase.KNOCKOUT = {
    OK: './img/circle.png',
    MAY: './img/triangle.png',
    NG: './img/cross.png'
  };

  function ObjectBase(objectType) {
    this.objectType = objectType;
  }

  ObjectBase.prototype.getObjectType = function() {
    return this.objectType;
  };

  ObjectBase.prototype.isCharacterObject = function() {
    return this.objectType === this.constructor.OBJECT_TYPE.CHARACTER;
  };

  ObjectBase.prototype.isEnemyObject = function() {
    return this.objectType === this.constructor.OBJECT_TYPE.ENEMY;
  };

  ObjectBase.prototype.getHpMax = function(level) {
    if (level == null) {
      level = null;
    }
    if (level === null) {
      return this.constructor.hpBase * this.level;
    } else {
      return this.constructor.hpBase * level;
    }
  };

  ObjectBase.prototype.getHp = function() {
    if (this.hp === null || this.getHpMax() < this.hp) {
      return this.getHpMax();
    } else if (this.hp <= 0) {
      return 0;
    } else {
      return this.hp;
    }
  };

  ObjectBase.prototype.damage = function(amount) {
    if (amount <= 0) {
      return false;
    }
    this.hp = this.getHp() - amount;
    return this.getHp();
  };

  ObjectBase.prototype.getLevel = function(level) {
    if (level == null) {
      level = null;
    }
    if (level === null) {
      return this.level;
    } else {
      return level;
    }
  };

  ObjectBase.prototype.setLevel = function(level) {
    return this.level = level;
  };

  ObjectBase.prototype.levelup = function(level) {
    return this.level += level;
  };

  ObjectBase.prototype.getCharacterName = function() {
    return this.constructor.characterName;
  };

  ObjectBase.prototype.getAttackType = function() {
    return this.constructor.attackTypeBase;
  };

  ObjectBase.prototype.getAttack = function(level) {
    if (level == null) {
      level = null;
    }
    if (level === null) {
      return this.constructor.attackBase * this.level;
    } else {
      return this.constructor.attackBase * level;
    }
  };

  ObjectBase.prototype.getAttackBase = function() {
    return this.constructor.attackBase;
  };

  ObjectBase.prototype.getPDef = function(level) {
    if (level == null) {
      level = null;
    }
    if (level === null) {
      return this.constructor.pDefBase * this.level;
    } else {
      return this.constructor.pDefBase * level;
    }
  };

  ObjectBase.prototype.getPDefBase = function() {
    return this.constructor.pDefBase;
  };

  ObjectBase.prototype.getMDef = function(level) {
    if (level == null) {
      level = null;
    }
    if (level === null) {
      return this.constructor.mDefBase * this.level;
    } else {
      return this.constructor.mDefBase * level;
    }
  };

  ObjectBase.prototype.getMDefBase = function() {
    return this.constructor.mDefBase;
  };

  ObjectBase.prototype.getMove = function() {
    return this.constructor.moveBase;
  };

  ObjectBase.prototype.getMoveBase = function() {
    return this.constructor.moveBase;
  };

  ObjectBase.prototype.getRange = function() {
    return this.constructor.rangeBase;
  };

  ObjectBase.prototype.getRangeBase = function() {
    return this.constructor.rangeBase;
  };

  ObjectBase.prototype.getHitRate = function() {
    return this.constructor.hitRateBase;
  };

  ObjectBase.prototype.getHitRateBase = function() {
    return this.constructor.hitRateBase;
  };

  ObjectBase.prototype.getDodgeRate = function() {
    return this.constructor.dodgeRateBase;
  };

  ObjectBase.prototype.getDodgeRateBase = function() {
    return this.constructor.dodgeRateBase;
  };

  ObjectBase.prototype.getExp = function() {
    return this.level * this.constructor.expRate;
  };

  ObjectBase.prototype.getAbilityName = function() {
    return this.constructor.abilityName;
  };

  ObjectBase.prototype.getAbilityDesc = function() {
    return this.constructor.abilityDesc;
  };

  ObjectBase.prototype.getBaseImage = function() {
    return this.constructor.images[0];
  };

  ObjectBase.prototype.getImages = function() {
    return this.constructor.images;
  };

  ObjectBase.prototype.getImage = function(index) {
    if (!((0 <= index && index < this.constructor.images.length))) {
      return null;
    }
    return this.constructor.images[index];
  };

  ObjectBase.prototype.getNeededExp = function(level) {
    var baseExp, baseLevel, targetExp, targetLevel;
    targetLevel = this.level + level;
    baseLevel = this.level;
    targetExp = (Math.pow(this.constructor.expRate, 2)) * (0.5 * targetLevel) * (targetLevel + 1);
    baseExp = (Math.pow(this.constructor.expRate, 2)) * (0.5 * baseLevel) * (baseLevel + 1);
    return targetExp - baseExp;
  };

  ObjectBase.prototype.getLevelUpMax = function(exp) {
    var baseExp, targetExp;
    baseExp = (Math.pow(this.constructor.expRate, 2)) * (0.5 * this.level) * (this.level + 1);
    targetExp = baseExp + exp;
    return Math.floor((-1 + Math.sqrt(1 + 8 * targetExp / (Math.pow(this.constructor.expRate, 2)))) / 2) - this.level;
  };

  ObjectBase.getDamageMin = function(attack, def) {
    var damage;
    damage = attack - def;
    if (damage < 1) {
      return 1;
    }
    damage = Math.round(damage - damage * this.DAMAGE_SHAKE_RATE);
    if (damage < 1) {
      return 1;
    }
    return damage;
  };

  ObjectBase.getDamageMax = function(attack, def) {
    var damage;
    damage = attack - def;
    if (damage < 1) {
      return 1;
    }
    damage = Math.round(damage + damage * this.DAMAGE_SHAKE_RATE);
    if (damage < 1) {
      return 1;
    }
    return damage;
  };

  ObjectBase.getDamage = function(attack, def) {
    return Utl.rand(this.getDamageMin(attack, def), this.getDamageMax(attack, def));
  };

  ObjectBase.getKnockoutRate = function(hp, attack, def) {
    var max, min;
    min = this.getDamageMin(attack, def);
    max = this.getDamageMax(attack, def);
    if (hp <= min) {
      return +2e308;
    } else if (hp <= max) {
      return Math.round((max - hp + 1) / (max - min + 1) * 100);
    } else {
      return -2e308;
    }
  };

  return ObjectBase;

})();

Cell = (function() {
  Cell.SIZE_X = 70;

  Cell.SIZE_Y = 70;

  Cell.OBJECT_ANIMATION_MSEC = 500;

  Cell.PUT_FIELD_MAX_X = 1;

  Cell.IMAGE_BACKGROUND = ['./img/background/light_blue.png'];

  Cell.IMAGE_MOVABLE = './img/movable.png';

  Cell.IMAGE_FIN = './img/fin.png';

  Cell.IMAGE_SNIPE = './img/target.png';

  function Cell(parentElement, xIndex1, yIndex1, borderSize) {
    this.parentElement = parentElement;
    this.xIndex = xIndex1;
    this.yIndex = yIndex1;
    this.stepObjectAnimation = bind(this.stepObjectAnimation, this);
    this.elements = {
      mother: null,
      collision: null,
      background: null,
      object: null,
      movable: null,
      knockout: null
    };
    this.object = null;
    this.tempObject = null;
    this.background = this.constructor.IMAGE_BACKGROUND[Utl.rand(0, this.constructor.IMAGE_BACKGROUND.length - 1)];
    this.wayStack = null;
    this.knockout = null;
    this.objectAnimationIndex = 0;
    this.initElements(borderSize);
  }

  Cell.prototype.onMouseMiddleUp = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    GameManager.changeControllable(false);
    return GameManager.changeControllable(true);
  };

  Cell.prototype.onMouseRightUp = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    GameManager.changeControllable(false);
    return GameManager.changeControllable(true);
  };

  Cell.prototype.onMouseLeftUp = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    GameManager.changeControllable(false);
    if (this.tryCharacterPut(evt)) {

    } else if (this.tryMovePick(evt)) {

    } else if (this.tryMoveTo(evt)) {

    } else if (this.tryAttack(evt)) {

    } else {
      return GameManager.changeControllable(true);
    }
  };

  Cell.prototype.onMouseLeftDown = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    GameManager.changeControllable(false);
    if (this.tempObject !== null) {
      CharacterPalletManager.pickCharacter(this.tempObject);
      this.tempObject = null;
    }
    return GameManager.changeControllable(true);
  };

  Cell.prototype.onMouseMiddleDown = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    GameManager.changeControllable(false);
    return GameManager.changeControllable(true);
  };

  Cell.prototype.onMouseRightDown = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    GameManager.changeControllable(false);
    return GameManager.changeControllable(true);
  };

  Cell.prototype.onMouseMove = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    if (GameManager.flags.isBattle) {
      if (this.object === null) {
        LeftInfoManager.setObject(null);
        return RightInfoManager.setObject(null);
      } else if (this.object.isCharacterObject()) {
        LeftInfoManager.setObject(this.object);
        return RightInfoManager.setObject(null);
      } else if (this.object.isEnemyObject()) {
        LeftInfoManager.setObject(null);
        return RightInfoManager.setObject(this.object);
      }
    }
  };

  Cell.prototype.onMouseLeave = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    GameManager.changeControllable(false);
    return GameManager.changeControllable(true);
  };

  Cell.prototype.setTempObject = function(object) {
    this.tempObject = object;
    object.setInField(true);
    return this.draw();
  };

  Cell.prototype.setObject = function(object) {
    this.object = object;
    this.tempObject = null;
    return this.draw();
  };

  Cell.prototype.switchTemp = function() {
    if (this.tempObject !== null) {
      this.object = this.tempObject;
      this.tempObject = null;
      return this.draw();
    }
  };

  Cell.prototype.initElements = function(borderSize) {
    var cssPos, cssSize;
    this.elements.mother = $('<div>').addClass('cell cell_mother').css({
      left: this.xIndex * this.constructor.SIZE_X + borderSize * (this.xIndex + 1),
      top: this.yIndex * this.constructor.SIZE_Y + borderSize * (this.yIndex + 1),
      width: this.constructor.SIZE_X,
      height: this.constructor.SIZE_Y
    });
    cssPos = {
      left: 0,
      top: 0
    };
    cssSize = {
      width: this.constructor.SIZE_X,
      height: this.constructor.SIZE_Y
    };
    this.elements.collision = $('<div>').addClass('cell cell_collision').css(cssPos).css(cssSize).on('mousemove', this.onMouseMove.bind(this)).on('mouseup', (function(_this) {
      return function(evt) {
        switch (evt.which) {
          case 1:
            return _this.onMouseLeftUp.bind(_this)(evt);
          case 2:
            return _this.onMouseMiddleUp.bind(_this)(evt);
          case 3:
            return _this.onMouseRightUp.bind(_this)(evt);
        }
      };
    })(this)).on('mousedown', (function(_this) {
      return function(evt) {
        switch (evt.which) {
          case 1:
            return _this.onMouseLeftDown.bind(_this)(evt);
          case 2:
            return _this.onMouseMiddleDown.bind(_this)(evt);
          case 3:
            return _this.onMouseRightDown.bind(_this)(evt);
        }
      };
    })(this)).on('mouseleave', this.onMouseLeave.bind(this)).appendTo(this.elements.mother);
    this.elements.background = $('<div>').addClass('cell cell_background').css(cssPos).css(cssSize).appendTo(this.elements.mother);
    this.elements.object = $('<img>').addClass('cell cell_object').css({
      left: 0,
      bottom: 10
    }).css({
      width: '100%'
    }).appendTo(this.elements.mother);
    this.elements.movable = $('<div>').addClass('cell cell_movable').css(cssPos).css(cssSize).addClass('no_display').appendTo(this.elements.mother);
    this.elements.fin = $('<div>').addClass('cell cell_fin').css(cssPos).css(cssSize).addClass('no_display').appendTo(this.elements.mother);
    this.elements.knockout = $('<div>').addClass('cell cell_knockout').css({
      right: 0,
      top: 0
    }).css({
      width: this.constructor.SIZE_X * 0.3,
      height: this.constructor.SIZE_Y * 0.3
    }).addClass('no_display').appendTo(this.elements.mother);
    this.elements.animation = $('<div>').addClass('cell cell_animation').css(cssPos).css(cssSize).addClass('no_display').appendTo(this.elements.mother);
    this.changeBackground(this.background);
    this.changeMovable(this.constructor.IMAGE_MOVABLE);
    this.changeFin(this.constructor.IMAGE_FIN);
    return $(this.elements.mother).appendTo(this.parentElement);
  };

  Cell.prototype.changeBackground = function(imagePath) {
    if (imagePath == null) {
      imagePath = null;
    }
    if (imagePath === null) {
      return this.elements.background.addClass('no_display');
    } else {
      return this.elements.background.css('background-image', 'url(' + imagePath + ')').removeClass('no_display');
    }
  };

  Cell.prototype.changeObject = function(imagePath) {
    if (imagePath == null) {
      imagePath = null;
    }
    if (imagePath === null) {
      return this.elements.object.addClass('no_display');
    } else {
      return this.elements.object.attr('src', imagePath).removeClass('no_display');
    }
  };

  Cell.prototype.changeAttackable = function(imagePath) {
    if (imagePath == null) {
      imagePath = null;
    }
    if (imagePath === null) {
      return this.elements.attackable.addClass('no_display');
    } else {
      return this.elements.attackable.css('background-image', 'url(' + imagePath + ')').removeClass('no_display');
    }
  };

  Cell.prototype.changeMovable = function(imagePath) {
    return this.elements.movable.css('background-image', 'url(' + imagePath + ')');
  };

  Cell.prototype.changeFin = function(imagePath) {
    return this.elements.fin.css('background-image', 'url(' + imagePath + ')');
  };

  Cell.prototype.changeKnockout = function(imagePath, num) {
    if (num == null) {
      num = '';
    }
    return this.elements.knockout.css('background-image', 'url(' + imagePath + ')').html(num).removeClass('no_display');
  };

  Cell.prototype.startAnimation = function(imagePath, startMsec, endMsec, callback) {
    if (callback == null) {
      callback = null;
    }
    setTimeout((function(_this) {
      return function() {
        return _this.elements.animation.css('background-image', 'url(' + imagePath + ')').removeClass('no_display');
      };
    })(this), startMsec);
    return setTimeout((function(_this) {
      return function() {
        _this.elements.animation.css('background-image', 'none').addClass('no_display');
        if (callback instanceof Function) {
          return callback();
        }
      };
    })(this), endMsec);
  };

  Cell.prototype.showObject = function(bool) {
    if (bool == null) {
      bool = true;
    }
    if (bool) {
      return this.elements.object.removeClass('no_display');
    } else {
      return this.elements.object.addClass('no_display');
    }
  };

  Cell.prototype.showMovable = function(bool) {
    if (bool == null) {
      bool = true;
    }
    if (bool) {
      return this.elements.movable.removeClass('no_display');
    } else {
      return this.elements.movable.addClass('no_display');
    }
  };

  Cell.prototype.showFin = function(bool) {
    if (bool == null) {
      bool = true;
    }
    if (bool) {
      return this.elements.fin.removeClass('no_display');
    } else {
      return this.elements.fin.addClass('no_display');
    }
  };

  Cell.prototype.showKnockout = function(bool) {
    if (bool == null) {
      bool = true;
    }
    if (bool) {
      return this.elements.knockout.removeClass('no_display');
    } else {
      return this.elements.knockout.addClass('no_display');
    }
  };

  Cell.prototype.draw = function() {
    this.changeBackground(this.background);
    if (this.object !== null) {
      this.changeObject(this.object.getBaseImage());
    } else if (this.tempObject !== null) {
      this.changeObject(this.tempObject.getBaseImage());
    } else {
      this.changeObject();
    }
    this.drawMovable();
    this.drawFin();
    return this.drawKnockout();
  };

  Cell.prototype.isDroppableCharacter = function() {
    return this.xIndex <= this.constructor.PUT_FIELD_MAX_X && this.object === null;
  };

  Cell.prototype.isEnterable = function() {
    return this.object === null;
  };

  Cell.prototype.tryCharacterPut = function(evt) {
    if (GameManager.flags.pickedCharacterObject === null && GameManager.flags.pickedCharacterElement === null) {
      return;
    }
    if (GameManager.flags.pickedCharacterObject !== null && this.isDroppableCharacter()) {
      FieldManager.removeAllTempObject(this.tempObject);
      this.setTempObject(GameManager.flags.pickedCharacterObject);
    }
    GameManager.flags.pickedCharacterObject = null;
    if (GameManager.flags.pickedCharacterElement !== null) {
      GameManager.flags.pickedCharacterElement.remove();
      GameManager.flags.pickedCharacterElement = null;
    }
    CharacterPalletManager.redraw();
    GameManager.changeControllable(true);
    return true;
  };

  Cell.prototype.tryMovePick = function(evt) {
    if (!GameManager.flags.isBattle) {
      return;
    }
    if (GameManager.flags.movePickCell !== null) {
      return;
    }
    if (GameManager.flags.waitAttackCell !== null) {
      return;
    }
    if (!(this.object !== null && this.object.isCharacterObject())) {
      return;
    }
    if (this.object.isMoved()) {
      return;
    }
    GameManager.movePick(this);
    GameManager.changeControllable(true);
    return true;
  };

  Cell.prototype.tryMoveTo = function(evt) {
    if (GameManager.flags.movePickCell === null) {
      return;
    }
    if (this.object !== null) {
      return;
    }
    if (this.wayStack === null) {
      return;
    }
    FieldManager.moveObject(GameManager.flags.movePickCell, this, function() {
      return GameManager.changeControllable(true);
    });
    return true;
  };

  Cell.prototype.tryAttack = function(evt) {
    if (GameManager.flags.waitAttackCell === null) {
      return;
    }
    if (this.knockout === null) {
      return;
    }
    return GameManager.attack(this.knockout, this, function() {
      GameManager.flags.movePickCell = null;
      GameManager.flags.moveToCell = null;
      GameManager.flags.waitAttackCell = null;
      return GameManager.changeControllable(true);
    });
  };

  Cell.prototype.setWayStack = function(wayStack) {
    return this.wayStack = wayStack;
  };

  Cell.prototype.drawMovable = function() {
    return this.showMovable(this.wayStack !== null);
  };

  Cell.prototype.drawKnockout = function() {
    var attack, attackType, def, hp, knockout;
    if (this.object !== null && this.knockout !== null) {
      attackType = this.knockout.object.getAttackType();
      attack = this.knockout.object.getAttack();
      def = attackType === ObjectBase.ATTACK_TYPE.PHYSIC ? this.object.getPDef() : this.object.getMDef();
      hp = this.object.getHp();
      knockout = ObjectBase.getKnockoutRate(hp, attack, def);
      if (knockout === +2e308) {
        return this.changeKnockout(ObjectBase.KNOCKOUT.OK);
      } else if (knockout === -2e308) {
        return this.changeKnockout(ObjectBase.KNOCKOUT.NG);
      } else {
        return this.changeKnockout(ObjectBase.KNOCKOUT.MAY, knockout);
      }
    } else {
      return this.showKnockout(false);
    }
  };

  Cell.prototype.drawFin = function() {
    if (this.object !== null && (this.object.isCharacterObject() || this.object.isEnemyObject()) && this.object.isMoved()) {
      return this.showFin(true);
    } else {
      return this.showFin(false);
    }
  };

  Cell.prototype.stepObjectAnimation = function() {
    if (this.object === null) {
      return this.showObject(false);
    }
    this.objectAnimationIndex++;
    if (this.object.getImage(this.objectAnimationIndex) === null) {
      this.objectAnimationIndex = 0;
    }
    return this.changeObject(this.object.getImage(this.objectAnimationIndex));
  };

  return Cell;

})();

CharacterBase = (function(superClass) {
  extend(CharacterBase, superClass);

  function CharacterBase(params) {
    CharacterBase.__super__.constructor.call(this, ObjectBase.OBJECT_TYPE.CHARACTER);
    if (params.joined === null) {
      this.joined = this.constructor.defaultJoin;
    } else {
      this.joined = params.joined;
    }
    this.level = params.level;
    this.hp = params.hp;
    this.items = params.items;
    this.inField = params.inField;
    this.moved = params.moved;
  }

  CharacterBase.prototype.getId = function() {
    return this.constructor.characterId;
  };

  CharacterBase.prototype.getName = function() {
    return this.constructor.characterName;
  };

  CharacterBase.prototype.isInField = function() {
    return this.inField;
  };

  CharacterBase.prototype.setInField = function(isInField) {
    this.inField = !!isInField;
    return CharacterPalletManager.redraw(this);
  };

  CharacterBase.prototype.isMoved = function() {
    return this.moved;
  };

  CharacterBase.prototype.setMoved = function(bool) {
    return this.moved = !!bool;
  };

  return CharacterBase;

})(ObjectBase);

CharacterPalletManager = (function() {
  function CharacterPalletManager() {}

  CharacterPalletManager.ID = 'character_pallet';

  CharacterPalletManager.SIZE_X = 400;

  CharacterPalletManager.SIZE_Y = 600;

  CharacterPalletManager.characters = [];

  CharacterPalletManager.panels = [];

  CharacterPalletManager.init = function(parentElement, posX, posY) {
    this.parentElement = parentElement;
    this.posX = posX;
    this.posY = posY;
    return this.divObject = $('<div>').attr('id', this.ID).addClass('no_display').css({
      width: this.SIZE_X,
      height: this.SIZE_Y,
      left: this.posX,
      top: this.posY
    }).appendTo(this.parentElement);
  };

  CharacterPalletManager.show = function() {
    return $(this.divObject).removeClass('no_display');
  };

  CharacterPalletManager.hide = function() {
    return $(this.divObject).addClass('no_display');
  };

  CharacterPalletManager.addCharacter = function(characterObject) {
    this.characters.push(characterObject);
    return this.draw();
  };

  CharacterPalletManager.draw = function() {
    var c, index, j, len, ref, results, top;
    this.characters.sort(function(a, b) {
      return Number(a.constructor.characterId) - Number(b.constructor.characterId);
    });
    this.panels = [];
    $('#' + this.ID + ' > .' + Panel.CLASSNAME).remove();
    ref = this.characters;
    results = [];
    for (index = j = 0, len = ref.length; j < len; index = ++j) {
      c = ref[index];
      top = index * Panel.SIZE_Y;
      results.push(this.panels.push(new Panel(this.divObject, c, top, 0, true)));
    }
    return results;
  };

  CharacterPalletManager.redraw = function(object) {
    if (object == null) {
      object = null;
    }
    return $.each(this.panels, function() {
      if (object === null || this.object !== null && object.getId() === this.object.getId()) {
        return this.draw();
      }
    });
  };

  CharacterPalletManager.pickCharacter = function(characterObject) {
    GameManager.flags.pickedCharacterObject = characterObject;
    FieldManager.removeAllTempObject(characterObject);
    GameManager.flags.pickedCharacterElement = $('<img>').addClass('picked_character').css({
      width: Cell.SIZE_X
    }).attr({
      src: characterObject.getBaseImage()
    }).appendTo(GameManager.gameElement);
    return GameManager.followPickedCharacterElement();
  };

  return CharacterPalletManager;

})();

EnemyBase = (function(superClass) {
  extend(EnemyBase, superClass);

  function EnemyBase(params) {
    EnemyBase.__super__.constructor.call(this, ObjectBase.OBJECT_TYPE.ENEMY);
    this.level = params.level;
    this.hp = params.hp;
    this.inField = params.inField;
    this.moved = params.moved;
  }

  EnemyBase.prototype.getId = function() {
    return this.constructor.characterId;
  };

  EnemyBase.prototype.getName = function() {
    return this.constructor.characterName;
  };

  EnemyBase.prototype.isInField = function() {
    return this.inField;
  };

  EnemyBase.prototype.setInField = function(isInField) {
    this.inField = !!isInField;
    return CharacterPalletManager.redraw(this);
  };

  EnemyBase.prototype.isMoved = function() {
    return this.moved;
  };

  EnemyBase.prototype.setMoved = function(bool) {
    return this.moved = !!bool;
  };

  return EnemyBase;

})(ObjectBase);

FieldManager = (function() {
  function FieldManager() {}

  FieldManager.ID = 'field';

  FieldManager.CELL_X = 18;

  FieldManager.CELL_Y = 8;

  FieldManager.BORDER_SIZE = 1;

  FieldManager.MOVE_SPEED = 50;

  FieldManager.ENEMY_APPEAR_WIDTH = 5;

  FieldManager.divObject = null;

  FieldManager.cells = [];

  FieldManager.nextField = [];

  FieldManager.cellAnimationTimer = false;

  FieldManager.init = function(parentElement) {
    var j, l, o, ref, ref1, ref2, x, y;
    this.parentElement = parentElement;
    this.divObject = $('<div>').attr('id', this.ID).css({
      width: this.CELL_X * Cell.SIZE_X + this.BORDER_SIZE * (this.CELL_X + 1),
      height: this.CELL_Y * Cell.SIZE_Y + this.BORDER_SIZE * (this.CELL_Y + 1),
      "background-color": '#000000'
    }).appendTo(this.parentElement);
    this.cells = [];
    for (x = j = 0, ref = this.CELL_X; 0 <= ref ? j < ref : j > ref; x = 0 <= ref ? ++j : --j) {
      this.cells[x] = [];
      for (y = l = 0, ref1 = this.CELL_Y; 0 <= ref1 ? l < ref1 : l > ref1; y = 0 <= ref1 ? ++l : --l) {
        this.cells[x][y] = new Cell(this.divObject, x, y, this.BORDER_SIZE);
      }
    }
    this.nextField = [];
    for (y = o = 0, ref2 = this.CELL_Y; 0 <= ref2 ? o < ref2 : o > ref2; y = 0 <= ref2 ? ++o : --o) {
      this.nextField[y] = null;
    }
    return this.startCellAnimation();
  };

  FieldManager.generateNextField = function() {};

  FieldManager.removeAllTempObject = function(characterObject) {
    if (characterObject === null) {
      return;
    }
    return $.each(this.cells, function() {
      return $.each(this, function() {
        if (this.tempObject !== null && this.tempObject.isCharacterObject() && this.tempObject.getId() === characterObject.getId()) {
          this.tempObject.setInField(false);
          this.tempObject = null;
          return this.draw();
        }
      });
    });
  };

  FieldManager.removeAllWayStack = function() {
    return $.each(this.cells, function() {
      return $.each(this, function() {
        return this.wayStack = null;
      });
    });
  };

  FieldManager.removeAllKnockout = function() {
    return $.each(this.cells, function() {
      return $.each(this, function() {
        return this.knockout = null;
      });
    });
  };

  FieldManager.resetAllMoved = function() {
    return $.each(this.cells, function() {
      return $.each(this, function() {
        if (this.object !== null && (this.object.isCharacterObject() || this.object.isEnemyObject())) {
          this.object.setMoved(false);
        }
        return true;
      });
    });
  };

  FieldManager.drawMovable = function() {
    return $.each(this.cells, function() {
      return $.each(this, function() {
        return this.drawMovable();
      });
    });
  };

  FieldManager.drawKnockout = function() {
    return $.each(this.cells, function() {
      return $.each(this, function() {
        return this.drawKnockout();
      });
    });
  };

  FieldManager.drawFin = function() {
    return $.each(this.cells, function() {
      return $.each(this, function() {
        return this.drawFin();
      });
    });
  };

  FieldManager.show = function() {
    return $(this.divObject).removeClass('no_display');
  };

  FieldManager.hide = function() {
    return $(this.divObject).addClass('no_display');
  };

  FieldManager.startCellAnimation = function() {
    FieldManager.stopObjectAnimation();
    return FieldManager.cellAnimationTimer = setInterval(function() {
      if (!GameManager.flags.isCellObjectAnimation) {
        return;
      }
      return $.each(FieldManager.cells, function() {
        return $.each(this, function() {
          return this.stepObjectAnimation();
        });
      });
    }, Cell.OBJECT_ANIMATION_MSEC);
  };

  FieldManager.stopObjectAnimation = function() {
    if (FieldManager.cellAnimationTimer !== false) {
      return clearInterval(FieldManager.cellAnimationTimer);
    }
  };

  FieldManager.moveObject = function(startCell, endCell, callback) {
    var charaObject, finish, showHide, wayStack;
    if (callback == null) {
      callback = null;
    }
    GameManager.changeControllable(false);
    if (startCell === endCell) {
      if (callback instanceof Function) {
        callback();
      }
      return;
    }
    wayStack = endCell.wayStack;
    FieldManager.removeAllWayStack();
    FieldManager.removeAllKnockout();
    FieldManager.drawMovable();
    FieldManager.drawKnockout();
    charaObject = startCell.object;
    finish = function() {
      var attackableCell, attackables, j, len;
      GameManager.flags.movePickCell = null;
      GameManager.flags.moveToCell = [startCell, endCell];
      attackables = FieldManager.getAttackableCellsByCell(endCell);
      if (attackables.length === 0) {
        GameManager.flags.waitAttackCell = null;
        if (endCell.object === null) {
          console.log(endCell);
        }
        endCell.object.setMoved(true);
      } else {
        GameManager.flags.waitAttackCell = endCell;
        for (j = 0, len = attackables.length; j < len; j++) {
          attackableCell = attackables[j];
          attackableCell.knockout = endCell;
        }
        FieldManager.drawKnockout();
      }
      GameManager.flags.movePickCell = null;
      endCell.draw();
      if (callback instanceof Function) {
        return callback();
      }
    };
    showHide = function(prevCell, wayStack) {
      var nextCell;
      if (wayStack.length === 0) {
        return finish();
      } else {
        nextCell = wayStack.shift();
        prevCell.setObject(null);
        nextCell.setObject(charaObject);
        prevCell.draw();
        nextCell.draw();
        return setTimeout(showHide.bind(null, nextCell, wayStack), FieldManager.MOVE_SPEED);
      }
    };
    setTimeout(showHide.bind(null, startCell, wayStack), FieldManager.MOVE_SPEED);
    return true;
  };

  FieldManager.getAttackableCellsByCell = function(cell) {
    return this.getAttackableCells(cell.object, cell.xIndex, cell.yIndex);
  };

  FieldManager.getAttackableCells = function(object, x, y) {
    var body, dist, j, l, len, len1, ref, res, targetCell, targetType, xIndex, yIndex;
    targetType = object === null ? [] : object.isCharacterObject() ? [ObjectBase.OBJECT_TYPE.ENEMY] : object.isEnemyObject() ? [ObjectBase.OBJECT_TYPE.CHARACTER] : [];
    if (targetType.length <= 0) {
      return [];
    }
    res = [];
    ref = this.cells;
    for (xIndex = j = 0, len = ref.length; j < len; xIndex = ++j) {
      body = ref[xIndex];
      for (yIndex = l = 0, len1 = body.length; l < len1; yIndex = ++l) {
        targetCell = body[yIndex];
        dist = Math.abs(x - targetCell.xIndex) + Math.abs(y - targetCell.yIndex);
        if (dist <= object.getRange()) {
          if (targetCell.object !== null && Utl.inArray(targetCell.object.getObjectType(), targetType)) {
            res.push(targetCell);
          }
        }
      }
    }
    return res;
  };

  FieldManager.getMovableMap = function(cell) {
    var allCellChecked, body, j, l, len, len1, len2, loopCount, movableMap, o, ref, ref1, ref2, ref3, wayStack, x, xPlus, y, yPlus;
    movableMap = Utl.array2dFill(this.CELL_X, this.CELL_Y, null);
    movableMap[cell.xIndex][cell.yIndex] = [];
    loopCount = 0;
    while (!allCellChecked && (loopCount <= this.CELL_X * this.CELL_Y)) {
      loopCount++;
      allCellChecked = true;
      for (x = j = 0, len = movableMap.length; j < len; x = ++j) {
        body = movableMap[x];
        for (y = l = 0, len1 = body.length; l < len1; y = ++l) {
          wayStack = body[y];
          if (wayStack === null) {
            if (this.cells[x][y].isEnterable()) {
              allCellChecked = false;
            }
          } else {
            ref = [[-1, 0], [1, 0], [0, -1], [0, 1]];
            for (o = 0, len2 = ref.length; o < len2; o++) {
              ref1 = ref[o], xPlus = ref1[0], yPlus = ref1[1];
              if (!((0 <= (ref2 = x + xPlus) && ref2 < this.cells.length))) {
                continue;
              }
              if (!((0 <= (ref3 = y + yPlus) && ref3 < this.cells[0].length))) {
                continue;
              }
              if (FieldManager.cells[x + xPlus][y + yPlus].isEnterable() && (movableMap[x + xPlus][y + yPlus] === null || wayStack.length + 1 < movableMap[x + xPlus][y + yPlus].length)) {
                movableMap[x + xPlus][y + yPlus] = wayStack.concat([this.cells[x + xPlus][y + yPlus]]);
              }
            }
          }
        }
      }
    }
    return movableMap;
  };

  FieldManager.randomEnemyAppear = function(callback) {
    var cnt, enemyAmount, flushCount, getEnemyObject, isNotEmpty, j, putEnemy, ref, res;
    if (callback == null) {
      callback = null;
    }
    GameManager.flags.isCellObjectAnimation = false;
    enemyAmount = Utl.gacha([[0, 10], [11, 20], [12, 30], [13, 40], [14, 30], [15, 20], [16, 10]]);
    flushCount = 5;
    getEnemyObject = (function(_this) {
      return function() {
        var enemyClass, id, ids, ref, targetId;
        ids = [];
        ref = GameManager.enemys;
        for (id in ref) {
          enemyClass = ref[id];
          if (enemyClass.appearance <= EnvManager.getFloor()) {
            ids.push(id);
          }
        }
        if (ids.length <= 0) {
          return null;
        }
        targetId = Utl.shuffle(ids).pop();
        return new GameManager.enemys[targetId]({
          level: EnvManager.getFloor(),
          hp: null,
          inField: true,
          moved: false
        });
      };
    })(this);
    putEnemy = (function(_this) {
      return function(enemyObject) {
        var cell, cnt, emptyCells, j, l, len, o, ref, ref1, ref2, ref3, targetCell, x;
        if (enemyObject === null) {
          return false;
        }
        emptyCells = [];
        for (x = j = ref = _this.cells.length - _this.ENEMY_APPEAR_WIDTH, ref1 = _this.cells.length; ref <= ref1 ? j < ref1 : j > ref1; x = ref <= ref1 ? ++j : --j) {
          ref2 = _this.cells[x];
          for (l = 0, len = ref2.length; l < len; l++) {
            cell = ref2[l];
            if (cell.object === null) {
              emptyCells.push(cell);
            }
          }
        }
        if (emptyCells.length <= 0) {
          return false;
        }
        targetCell = Utl.shuffle(emptyCells).pop();
        targetCell.setObject(enemyObject);
        targetCell.draw();
        for (cnt = o = 0, ref3 = flushCount; 0 <= ref3 ? o < ref3 : o > ref3; cnt = 0 <= ref3 ? ++o : --o) {
          setTimeout(targetCell.showObject.bind(targetCell, false), cnt * 100 + 50);
          setTimeout(targetCell.showObject.bind(targetCell, true), cnt * 100 + 100);
        }
        return true;
      };
    })(this);
    isNotEmpty = false;
    for (cnt = j = 0, ref = enemyAmount; 0 <= ref ? j < ref : j > ref; cnt = 0 <= ref ? ++j : --j) {
      res = putEnemy(getEnemyObject());
    }
    setTimeout((function(_this) {
      return function() {
        GameManager.flags.isCellObjectAnimation = true;
        return callback();
      };
    })(this), (flushCount + 1) * 100);
    return true;
  };

  return FieldManager;

})();

GameManager = (function() {
  function GameManager() {}

  GameManager.DEBUG_CONFIG = {
    DISABLE_RIGHT_CLICK_MENU: false
  };

  GameManager.ID = 'game';

  GameManager.mousePos = {
    x: 0,
    y: 0
  };

  GameManager.gameElement = null;

  GameManager.characters = [];

  GameManager.enemy = [];

  GameManager.initialized = {
    characters: false,
    field: false,
    menu: false,
    enemys: false,
    levelup: false,
    env: false
  };

  GameManager.flags = {
    controllable: true,
    isCellObjectAnimation: true,
    isEnableCharacterPick: true,
    isCharacterPick: false,
    pickedCharacterObject: null,
    pickedCharacterElement: null,
    isEnableBattle: true,
    isBattle: false,
    movePickCell: null,
    moveToCell: null,
    waitAttackCell: null,
    isEnableTurnEnd: true,
    isEnableLevelup: true
  };

  GameManager.POSITION = {
    BATTLE: {
      menu: [0, 0],
      character_pallet: null,
      field: [0, 50],
      left_info: [200, 630],
      right_info: [600, 630],
      env: [0, 630],
      levelup: null
    },
    CHARACTER_PICK: {
      menu: [0, 0],
      character_pallet: [140, 50],
      field: [0, 50],
      left_info: null,
      right_info: null,
      env: [0, 630],
      levelup: null
    },
    LEVELUP: {
      menu: [0, 0],
      character_pallet: null,
      field: [0, 50],
      left_info: null,
      right_info: null,
      env: [0, 630],
      levelup: [0, 50]
    }
  };

  GameManager.ANIMATION_MSEC = 500;

  GameManager.onMouseMiddleDown = function(evt) {
    if (!this.isControllable()) {
      return;
    }
    return true;
  };

  GameManager.onMouseMiddleUp = function(evt) {
    if (!this.isControllable()) {
      return;
    }
    return true;
  };

  GameManager.onMouseRightDown = function(evt) {
    if (!this.isControllable()) {
      return;
    }
    return true;
  };

  GameManager.onMouseRightUp = function(evt) {
    if (!this.isControllable()) {
      return;
    }
    return true;
  };

  GameManager.onMouseLeftDown = function(evt) {
    if (!this.isControllable()) {
      return;
    }
    return true;
  };

  GameManager.onMouseLeftUp = function(evt) {
    if (!this.isControllable()) {
      return;
    }
    console.log('game mouseup');
    if (this.flags.pickedCharacterObject !== null) {
      this.flags.pickedCharacterObject = null;
    }
    if (this.flags.pickedCharacterElement !== null) {
      this.flags.pickedCharacterElement.remove();
      this.flags.pickedCharacterElement = null;
    }
    return true;
  };

  GameManager.onMouseLeave = function(evt) {
    if (!this.isControllable()) {
      return;
    }
    return true;
  };

  GameManager.onMouseMove = function(evt) {
    var ref;
    if (!this.isControllable()) {
      return;
    }
    ref = Utl.e2localPos(evt), this.mousePos.x = ref[0], this.mousePos.y = ref[1];
    if (this.flags.pickedCharacterElement !== null) {
      this.followPickedCharacterElement(evt);
    }
    return true;
  };

  GameManager.followPickedCharacterElement = function(evt) {
    if (this.flags.pickedCharacterElement !== null) {
      return this.flags.pickedCharacterElement.css({
        left: this.mousePos.x - 90 / 2,
        top: this.mousePos.y - 90 / 2
      }).removeClass('no_display');
    }
  };

  GameManager.doBattle = function(isSoon) {
    if (isSoon == null) {
      isSoon = false;
    }
    if (!this.flags.isEnableBattle) {
      return;
    }
    this.partsAnimation(this.POSITION.BATTLE, isSoon);
    this.flags.isCharacterPick = false;
    this.flags.pickedCharacterObject = null;
    if (this.flags.pickedCharacterElement !== null) {
      this.flags.pickedCharacterElement.remove();
    }
    this.flags.pickedCharacterElement = null;
    this.switchTempAll();
    return this.flags.isBattle = true;
  };

  GameManager.doCharacterPick = function(isSoon) {
    if (isSoon == null) {
      isSoon = false;
    }
    if (!this.flags.isEnableCharacterPick) {
      return;
    }
    this.partsAnimation(this.POSITION.CHARACTER_PICK, isSoon);
    this.flags.isCharacterPick = true;
    this.flags.pickedCharacterObject = null;
    if (this.flags.pickedCharacterElement !== null) {
      this.flags.pickedCharacterElement.remove();
    }
    this.flags.pickedCharacterElement = null;
    this.switchTempAll();
    return this.flags.isBattle = false;
  };

  GameManager.doTurnEnd = function(isSoon) {
    if (isSoon == null) {
      isSoon = false;
    }
    if (!this.flags.isEnableTurnEnd) {
      return;
    }
    return this.enemyMove();
  };

  GameManager.doLevelup = function(isSoon) {
    if (isSoon == null) {
      isSoon = false;
    }
    if (!this.flags.isEnableLevelup) {
      return;
    }
    return this.partsAnimation(this.POSITION.LEVELUP, isSoon);
  };

  GameManager.partsAnimation = function(ary, isSoon) {
    var animationMsec, id, pos;
    if (isSoon == null) {
      isSoon = false;
    }
    this.changeControllable(false);
    animationMsec = isSoon ? 0 : this.ANIMATION_MSEC;
    for (id in ary) {
      pos = ary[id];
      if (pos === null) {
        $('#' + id).slideUp(animationMsec);

        /*
        if isSoon
          $('#'+id).css('display', 'none')
        else
          $('#'+id).slideUp(@ANIMATION_MSEC)
         */
      } else {
        $('#' + id).animate({
          left: pos[0],
          top: pos[1]
        }, animationMsec).slideDown(animationMsec);

        /*
        if isSoon
          $('#'+id).css('display', 'block').css({left: pos[0], top: pos[1]})
        else
          $('#'+id).slideDown(@ANIMATION_MSEC).css({left: pos[0], top: pos[1]})
         */
      }
    }
    return setTimeout((function(_this) {
      return function() {
        return _this.changeControllable(true);
      };
    })(this), animationMsec);
  };

  GameManager.init = function() {
    $(document).on('contextmenu', function() {
      return !GameManager.DEBUG_CONFIG.DISABLE_RIGHT_CLICK_MENU;
    });
    this.gameElement = $('<div>').attr('id', this.ID).on('mousemove', this.onMouseMove.bind(this)).on('mouseup', (function(_this) {
      return function(evt) {
        switch (evt.which) {
          case 1:
            return _this.onMouseLeftUp.bind(_this)(evt);
          case 2:
            return _this.onMouseMiddleUp.bind(_this)(evt);
          case 3:
            return _this.onMouseRightUp.bind(_this)(evt);
        }
      };
    })(this)).on('mousedown', (function(_this) {
      return function(evt) {
        switch (evt.which) {
          case 1:
            return _this.onMouseLeftDown.bind(_this)(evt);
          case 2:
            return _this.onMouseMiddleDown.bind(_this)(evt);
          case 3:
            return _this.onMouseRightDown.bind(_this)(evt);
        }
      };
    })(this)).on('mouseleave', this.onMouseLeave.bind(this)).css({
      width: 1200,
      height: 800
    });
    this.initField(null);
    this.initEnv(null);
    this.initMenu(null);
    this.initPanels(null);
    this.initCharacters(null);
    this.initLevelup(null);
    this.initEnemys(null);
    this.gameElement.appendTo('body');
    return this.doBattle(true);
  };

  GameManager.initMenu = function(savedata) {
    if (this.initialized.menu) {
      return;
    }
    this.initialized.menu = true;
    return MenuManager.init(this.gameElement);
  };

  GameManager.initField = function(savedata) {
    if (this.initialized.field) {
      return;
    }
    this.initialized.field = true;
    return FieldManager.init(this.gameElement);
  };

  GameManager.initEnv = function(savedata) {
    if (this.initialized.env) {
      return;
    }
    this.initialized.env = true;
    EnvManager.init(this.gameElement);
    EnvManager.setLife(5);
    EnvManager.setExp(0);
    return EnvManager.setFloor(1);
  };

  GameManager.initPanels = function(savedata) {
    if (this.initialized.panels) {
      return;
    }
    this.initialized.panels = true;
    LeftInfoManager.init(this.gameElement);
    return RightInfoManager.init(this.gameElement);
  };

  GameManager.initLevelup = function(savedata) {
    var characterId, characterObject, ref, results;
    if (this.initialized.levelup) {
      return;
    }
    this.initialized.levelup = true;
    LevelupManager.init(this.gameElement);
    ref = this.characters;
    results = [];
    for (characterId in ref) {
      characterObject = ref[characterId];
      results.push(LevelupManager.addCharacter(characterObject));
    }
    return results;
  };

  GameManager.initCharacters = function(savedata) {
    var characterId, characterObject, className, params, ref, ref1;
    if (this.initialized.characters) {
      return;
    }
    this.initialized.characters = true;
    CharacterPalletManager.init(this.gameElement, 0, 50);
    this.characters = {};
    ref = window.CharacterList;
    for (characterId in ref) {
      className = ref[characterId];
      if ((savedata != null) && 'characters' in savedata && characterId in savedata.characters) {
        params = savedata.characters[characterId];
      } else {
        params = {
          joined: null,
          level: 1,
          hp: null,
          items: [],
          inField: false,
          moved: false
        };
      }
      this.characters[characterId] = new window.CharacterList[characterId](params);
    }
    ref1 = this.characters;
    for (characterId in ref1) {
      characterObject = ref1[characterId];
      CharacterPalletManager.addCharacter(characterObject);
    }
    return CharacterPalletManager.show();
  };

  GameManager.initEnemys = function(savedata) {
    if (this.initialized.enemys) {
      return;
    }
    this.initialized.enemys = true;
    return this.enemys = window.EnemyList;
  };

  GameManager.isControllable = function() {
    return this.flags.controllable;
  };

  GameManager.changeControllable = function(bool) {
    return this.flags.controllable = !!bool;
  };

  GameManager.switchTempAll = function() {
    return $.each(FieldManager.cells, function() {
      return $.each(this, function() {
        return this.switchTemp();
      });
    });
  };

  GameManager.movePick = function(cell) {
    var attackableCell, attackables, body, j, l, len, len1, len2, movableMap, o, ref, wayStack, x, y;
    FieldManager.removeAllWayStack();
    FieldManager.removeAllKnockout();
    this.flags.movePickCell = cell;
    this.flags.waitAttackCell = cell;
    movableMap = FieldManager.getMovableMap(cell);
    for (x = j = 0, len = movableMap.length; j < len; x = ++j) {
      body = movableMap[x];
      for (y = l = 0, len1 = body.length; l < len1; y = ++l) {
        wayStack = body[y];
        if (wayStack !== null && (0 < (ref = wayStack.length) && ref <= cell.object.getMove())) {
          FieldManager.cells[x][y].setWayStack(wayStack);
        } else {
          FieldManager.cells[x][y].setWayStack(null);
        }
      }
    }
    attackables = FieldManager.getAttackableCellsByCell(cell);
    for (o = 0, len2 = attackables.length; o < len2; o++) {
      attackableCell = attackables[o];
      attackableCell.knockout = cell;
    }
    FieldManager.drawMovable();
    return FieldManager.drawKnockout();
  };

  GameManager.enemyMove = function() {
    var _, acts, atkCell, atkObj, attackables, beatLevel, beatPossibility, c, damage, debugCount, def, ending, enemyCell, getAct, hp, j, l, len, len1, len2, level, mBody, movableMap, moveToCell, myAttack, myAttackType, o, q, r, ref, ref1, ref2, ref3, wayStack, x, xMove, y, yMove;
    debugCount = 0;
    this.changeControllable(false);
    this.flags.moveToCell = null;
    FieldManager.removeAllWayStack();
    FieldManager.removeAllKnockout();
    FieldManager.drawMovable();
    FieldManager.drawKnockout();
    ending = (function(_this) {
      return function() {
        FieldManager.resetAllMoved();
        FieldManager.drawMovable();
        FieldManager.drawKnockout();
        FieldManager.drawFin();
        _this.flags.movePickCell = null;
        _this.flags.moveToCell = null;
        _this.flags.waitAttackCell = null;
        return FieldManager.randomEnemyAppear(function() {
          return GameManager.changeControllable(true);
        });
      };
    })(this);
    enemyCell = null;
    enemysearch://;
    for (x = j = 0, ref = FieldManager.cells.length; 0 <= ref ? j < ref : j > ref; x = 0 <= ref ? ++j : --j) {
      for (y = l = 0, ref1 = FieldManager.cells[x].length; 0 <= ref1 ? l < ref1 : l > ref1; y = 0 <= ref1 ? ++l : --l) {
        c = FieldManager.cells[x][y];
        if (c.object !== null && c.object.isEnemyObject() && !c.object.isMoved()) {
          enemyCell = c;
          break enemysearch;
        }
      }
    }
    if (enemyCell === null) {
      return ending();
    }
    getAct = function(params) {
      var rtn;
      rtn = {
        life: 0,
        beatLevel: 0,
        beatPossibility: -2e308,
        damage: 0,
        xMove: +2e308,
        moveAmount: +2e308
      };
      if ('life' in params) {
        rtn.life = params.life;
      }
      if ('beatLevel' in params) {
        rtn.beatLevel = params.beatLevel;
      }
      if ('beatPossibility' in params) {
        rtn.beatPossibility = params.beatPossibility;
      }
      if ('damage' in params) {
        rtn.damage = params.damage;
      }
      if ('xMove' in params) {
        rtn.xMove = params.xMove;
      }
      if ('moveAmount' in params) {
        rtn.moveAmount = params.moveAmount;
      }
      return rtn;
    };
    acts = [];
    movableMap = FieldManager.getMovableMap(enemyCell);
    myAttackType = enemyCell.object.getAttackType();
    myAttack = enemyCell.object.getAttack();
    actsearch://;
    for (xMove = o = 0, len = movableMap.length; o < len; xMove = ++o) {
      mBody = movableMap[xMove];
      for (yMove = q = 0, len1 = mBody.length; q < len1; yMove = ++q) {
        wayStack = mBody[yMove];
        if (!(wayStack !== null && (0 <= (ref2 = wayStack.length) && ref2 <= enemyCell.object.getMove()))) {
          continue;
        }
        moveToCell = FieldManager.cells[xMove][yMove];
        moveToCell.setWayStack(wayStack);
        if (xMove === 0 && (enemyCell.object.getMove() - wayStack.length) > 0) {
          acts.push([
            getAct({
              life: 1,
              moveAmount: wayStack.length
            }), moveToCell, -1
          ]);
        }
        acts.push([
          getAct({
            xMove: xMove,
            moveAmount: wayStack.length
          }), moveToCell, null
        ]);
        attackables = FieldManager.getAttackableCells(enemyCell.object, xMove, yMove);
        for (r = 0, len2 = attackables.length; r < len2; r++) {
          atkCell = attackables[r];
          atkObj = atkCell.object;
          def = myAttackType === ObjectBase.ATTACK_TYPE.PHYSIC ? atkObj.getPDef() : atkObj.getMDef();
          hp = atkObj.getHp();
          level = atkObj.getLevel();
          beatPossibility = ObjectBase.getKnockoutRate(hp, myAttack, def);
          damage = ObjectBase.getDamageMax(myAttack, def);
          beatLevel = beatPossibility === +2e308 ? level : 0;
          acts.push([
            getAct({
              beatLevel: beatLevel,
              beatPossibility: beatPossibility,
              damage: damage,
              xMove: xMove,
              moveAmount: wayStack.length
            }), moveToCell, atkCell
          ]);
        }
      }
    }
    acts.sort(function(aAry, bAry) {
      var a, b;
      a = aAry[0];
      b = bAry[0];
      if (a.life > b.life) {
        return -1;
      }
      if (a.life < b.life) {
        return 1;
      }
      if (a.beatLevel > b.beatLevel) {
        return -1;
      }
      if (a.beatLevel < b.beatLevel) {
        return 1;
      }
      if (a.beatPossibility > b.beatPossibility) {
        return -1;
      }
      if (a.beatPossibility < b.beatPossibility) {
        return 1;
      }
      if (a.damage > b.damage) {
        return -1;
      }
      if (a.damage < b.damage) {
        return 1;
      }
      if (a.xMove < b.xMove) {
        return -1;
      }
      if (a.xMove > b.xMove) {
        return 1;
      }
      if (a.moveAmount > b.moveAmount) {
        return -1;
      }
      if (a.moveAmount < b.moveAmount) {
        return 1;
      }
      return 0;
    });
    ref3 = acts[0], _ = ref3[0], moveToCell = ref3[1], atkCell = ref3[2];
    FieldManager.moveObject(enemyCell, moveToCell, (function(_this) {
      return function() {
        if (atkCell === null) {
          moveToCell.object.setMoved(true);
          moveToCell.drawFin();
          return setTimeout(_this.enemyMove.bind(_this), 1);
        } else if (atkCell === -1) {
          return _this.terror(moveToCell, _this.enemyMove.bind(_this));
        } else {
          return _this.attack(moveToCell, atkCell, _this.enemyMove.bind(_this));
        }
      };
    })(this));
    return true;
  };

  GameManager.attack = function(attackerCell, defenderCell, callback) {
    var attacker, defender, leftObject, rightObject;
    if (callback == null) {
      callback = null;
    }
    attacker = attackerCell.object;
    defender = defenderCell.object;
    leftObject = attacker.isCharacterObject() ? attacker : defender;
    rightObject = attacker.isCharacterObject() ? defender : attacker;
    LeftInfoManager.setObject(leftObject);
    RightInfoManager.setObject(rightObject);
    defenderCell.startAnimation('./img/target.png', 0, 100);
    defenderCell.startAnimation('./img/target.png', 200, 300);
    defenderCell.startAnimation('./img/target.png', 400, 500);
    defenderCell.startAnimation('./img/damage.png', 550, 1750);
    return setTimeout(function() {
      var attack, attackType, damage, def, hp;
      attackType = attacker.getAttackType();
      attack = attacker.getAttack();
      def = attack === ObjectBase.ATTACK_TYPE.PHYSIC ? defender.getPDef() : defender.getMDef();
      hp = defender.getHp();
      damage = ObjectBase.getDamage(attack, def);
      if (defender.damage(damage) <= 0) {
        if (defender.isEnemyObject()) {
          ExpManager.plusAmount(defender.getExp());
        }
        defenderCell.object = null;
      }
      attacker.setMoved(true);
      attackerCell.draw();
      defenderCell.draw();
      FieldManager.removeAllWayStack();
      FieldManager.removeAllKnockout();
      if (callback instanceof Function) {
        return setTimeout(callback, 1);
      }
    }, 1700);
  };

  GameManager.terror = function(cell, callback) {
    if (callback == null) {
      callback = null;
    }
    EnvManager.decreaseLife();
    cell.object = null;
    cell.draw();
    if (callback instanceof Function) {
      return setTimeout(callback, 1);
    }
  };

  return GameManager;

})();

InfoManager = (function() {
  function InfoManager() {}

  InfoManager.init = function(parentElement) {
    this.parentElement = parentElement;
    this.divObject = $('<div>').attr('id', this.ID).css({
      width: Panel.SIZE_X,
      height: Panel.SIZE_Y,
      "background-color": '#000000'
    }).appendTo(this.parentElement);
    return this.panel = new Panel(this.divObject, null);
  };

  InfoManager.setObject = function(object) {
    if (object == null) {
      object = null;
    }
    this.panel.object = object;
    return this.panel.draw();
  };

  InfoManager.show = function() {
    return this.divObject.addClass('no_display');
  };

  InfoManager.hide = function() {
    return this.divObject.addClass('no_display');
  };

  return InfoManager;

})();

LeftInfoManager = (function(superClass) {
  extend(LeftInfoManager, superClass);

  function LeftInfoManager() {
    return LeftInfoManager.__super__.constructor.apply(this, arguments);
  }

  LeftInfoManager.ID = 'left_info';

  return LeftInfoManager;

})(InfoManager);

MenuManager = (function() {
  function MenuManager() {}

  MenuManager.ID = 'menu';

  MenuManager.SIZE_X = 1200;

  MenuManager.SIZE_Y = 50;

  MenuManager.elements = {
    pickCharacter: null
  };

  MenuManager.init = function(parentElement, posX, posY) {
    this.parentElement = parentElement;
    this.posX = posX;
    this.posY = posY;
    this.divObject = $('<div>').attr('id', this.ID).css({
      width: this.SIZE_X,
      height: this.SIZE_Y,
      left: this.posX,
      top: this.posY
    });
    this.pickCharacter = $('<div>').html('出撃').css({
      border: '1px solid #000000',
      width: 100,
      height: 40,
      "font-size": '30px'
    }).on('click', this.onClickCharacterPick.bind(this)).appendTo(this.divObject);
    this.battle = $('<div>').html('戦闘').css({
      border: '1px solid #000000',
      width: 100,
      height: 40,
      "font-size": '30px'
    }).on('click', this.onClickBattle.bind(this)).appendTo(this.divObject);
    this.turnEnd = $('<div>').html('ターン終了').css({
      border: '1px solid #000000',
      width: 100,
      height: 40,
      "font-size": '30px'
    }).on('click', this.onClickTurnEnd.bind(this)).appendTo(this.divObject);
    this.turnEnd = $('<div>').html('レベルアップ').css({
      border: '1px solid #000000',
      width: 100,
      height: 40,
      "font-size": '30px'
    }).on('click', this.onClickLevelup.bind(this)).appendTo(this.divObject);
    return this.divObject.appendTo(this.parentElement);
  };

  MenuManager.onClickCharacterPick = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    GameManager.doCharacterPick();
    return true;
  };

  MenuManager.onClickBattle = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    GameManager.doBattle();
    return true;
  };

  MenuManager.onClickTurnEnd = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    GameManager.doTurnEnd();
    return true;
  };

  MenuManager.onClickLevelup = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    GameManager.doLevelup();
    return true;
  };

  return MenuManager;

})();

Panel = (function() {
  Panel.SIZE_X = 400;

  Panel.SIZE_Y = 120;

  Panel.CLASSNAME = 'panel';

  function Panel(parentElement, object1, posY, posX, isCharacterPallet) {
    this.parentElement = parentElement;
    this.object = object1;
    this.posY = posY != null ? posY : 0;
    this.posX = posX != null ? posX : 0;
    this.isCharacterPallet = isCharacterPallet != null ? isCharacterPallet : false;
    this.divObject = $('<div>').addClass(this.constructor.CLASSNAME).css({
      width: this.constructor.SIZE_X,
      height: this.constructor.SIZE_Y,
      top: this.posY,
      left: this.posX
    }).appendTo(this.parentElement);
    this.draw();
  }

  Panel.prototype.onIconDragStart = function(evt) {
    if (!GameManager.isControllable()) {
      return;
    }
    if (!this.isCharacterPallet) {
      return;
    }
    if (!GameManager.flags.isCharacterPick) {
      return;
    }
    if (!this.object.isCharacterObject()) {
      return;
    }
    if (this.object.isInField()) {
      return true;
    }
    CharacterPalletManager.pickCharacter(this.object);
    return true;
  };

  Panel.prototype.draw = function(level) {
    if (level == null) {
      level = null;
    }
    $(this.divObject).find('*').remove();
    if (this.object !== null) {
      switch (this.object.objectType) {
        case ObjectBase.OBJECT_TYPE.CHARACTER:
          return this.drawCharacter(level);
        case ObjectBase.OBJECT_TYPE.ENEMY:
          return this.drawEnemy();
      }
    }
  };

  Panel.prototype.drawCharacter = function(level) {
    var attackImg;
    if (level == null) {
      level = null;
    }
    if (this.isCharacterPallet && this.object.isInField()) {
      $('<div>').addClass('in_field').css({
        left: 0,
        top: 0,
        "z-index": 9999,
        opacity: 0.5,
        "background-color": '#230381',
        width: this.constructor.SIZE_X,
        height: this.constructor.SIZE_Y,
        'font-size': '80px',
        color: '#000000',
        'text-align': 'center'
      }).html('出撃中').appendTo(this.divObject);
    }
    $(this.divObject).append($('<div>').addClass('field_icon').css({
      top: 20,
      left: 0,
      width: 90,
      height: 90,
      "background-image": 'url(' + this.object.getBaseImage() + ')'
    }).on('mousedown', (function(_this) {
      return function(evt) {
        if (evt.which === 1) {
          _this.onIconDragStart.bind(_this)(evt);
        }
        return true;
      };
    })(this)));
    $(this.divObject).append($('<div>').addClass('label_level').css({
      top: 0,
      left: 0,
      width: 20,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('Lv'));
    $(this.divObject).append($('<div>').addClass('field_level').css({
      top: 0,
      left: 20,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html(this.object.getLevel(level)));
    $(this.divObject).append($('<div>').addClass('field_name').css({
      top: 0,
      left: 90,
      width: 120,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html(this.object.getCharacterName()));
    $(this.divObject).append($('<div>').addClass('label_attack').css({
      top: 25,
      left: 90,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('攻撃'));
    attackImg = this.object.getAttackType() === '物理' ? './img/sword.png' : './img/magic.png';
    $(this.divObject).append($('<img>').addClass('field_attack_type').css({
      top: 25,
      left: 130,
      width: 20,
      height: 20
    }).attr('src', attackImg));
    $(this.divObject).append($('<div>').addClass('field_attack').css({
      top: 25,
      left: 160,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getAttack(level)));
    $(this.divObject).append($('<div>').addClass('label_pdef').css({
      top: 45,
      left: 90,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('物防'));
    $(this.divObject).append($('<div>').addClass('field_pdef').css({
      top: 45,
      left: 160,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getPDef(level)));
    $(this.divObject).append($('<div>').addClass('label_mdef').css({
      top: 65,
      left: 90,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('魔防'));
    $(this.divObject).append($('<div>').addClass('field_mdef').css({
      top: 65,
      left: 160,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getMDef(level)));
    $(this.divObject).append($('<div>').addClass('label_hp').css({
      top: 0,
      left: 180,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('HP'));
    $(this.divObject).append($('<div>').addClass('field_hp').css({
      top: 0,
      left: 220,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getHp()));
    $(this.divObject).append($('<div>').addClass('label_hp_split').css({
      top: 0,
      left: 280,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html('/'));
    $(this.divObject).append($('<div>').addClass('field_hp_max').css({
      top: 0,
      left: 300,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getHpMax(level)));
    $(this.divObject).append($('<div>').addClass('label_hit_rate').css({
      top: 25,
      left: 210,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('命中'));
    $(this.divObject).append($('<div>').addClass('field_hit_rate').css({
      top: 25,
      left: 260,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getHitRate()));
    $(this.divObject).append($('<div>').addClass('label_dodge_rate').css({
      top: 45,
      left: 210,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('回避'));
    $(this.divObject).append($('<div>').addClass('field_dodge_rate').css({
      top: 45,
      left: 260,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getDodgeRate()));
    $(this.divObject).append($('<div>').addClass('label_move').css({
      top: 25,
      left: 310,
      width: 50,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('移動'));
    $(this.divObject).append($('<div>').addClass('field_move').css({
      top: 25,
      left: 360,
      width: 50,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getMove()));
    $(this.divObject).append($('<div>').addClass('label_range').css({
      top: 45,
      left: 310,
      width: 50,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('射程'));
    $(this.divObject).append($('<div>').addClass('field_range').css({
      top: 45,
      left: 360,
      width: 50,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getMove()));
    $(this.divObject).append($('<div>').addClass('label_ability').css({
      top: 85,
      left: 90,
      width: 50,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('能力'));
    return $(this.divObject).append($('<div>').addClass('field_ability').css({
      top: 85,
      left: 130,
      width: 250,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getAbilityName()).tooltip({
      'placement': 'top',
      'title': this.object.getAbilityDesc()
    }));
  };

  Panel.prototype.drawEnemy = function() {
    var attackImg;
    $(this.divObject).append($('<div>').addClass('field_icon').css({
      top: 20,
      left: 0,
      width: 90,
      height: 90,
      "background-image": 'url(' + this.object.getBaseImage() + ')'
    }));
    $(this.divObject).append($('<div>').addClass('label_level').css({
      top: 0,
      left: 0,
      width: 20,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('Lv'));
    $(this.divObject).append($('<div>').addClass('field_level').css({
      top: 0,
      left: 20,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html(this.object.getLevel()));
    $(this.divObject).append($('<div>').addClass('field_name').css({
      top: 0,
      left: 90,
      width: 120,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html(this.object.getCharacterName()));
    $(this.divObject).append($('<div>').addClass('label_attack').css({
      top: 25,
      left: 90,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('攻撃'));
    attackImg = this.object.getAttackType() === '物理' ? './img/sword.png' : './img/magic.png';
    $(this.divObject).append($('<img>').addClass('field_attack_type').css({
      top: 25,
      left: 130,
      width: 20,
      height: 20
    }).attr('src', attackImg));
    $(this.divObject).append($('<div>').addClass('field_attack').css({
      top: 25,
      left: 160,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getAttack()));
    $(this.divObject).append($('<div>').addClass('label_pdef').css({
      top: 45,
      left: 90,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('物防'));
    $(this.divObject).append($('<div>').addClass('field_pdef').css({
      top: 45,
      left: 160,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getPDef()));
    $(this.divObject).append($('<div>').addClass('label_mdef').css({
      top: 65,
      left: 90,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('魔防'));
    $(this.divObject).append($('<div>').addClass('field_mdef').css({
      top: 65,
      left: 160,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getMDef()));
    $(this.divObject).append($('<div>').addClass('label_hp').css({
      top: 0,
      left: 180,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('HP'));
    $(this.divObject).append($('<div>').addClass('field_hp').css({
      top: 0,
      left: 220,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getHp()));
    $(this.divObject).append($('<div>').addClass('label_hp_split').css({
      top: 0,
      left: 280,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html('/'));
    $(this.divObject).append($('<div>').addClass('field_hp_max').css({
      top: 0,
      left: 300,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getHpMax()));
    $(this.divObject).append($('<div>').addClass('label_hit_rate').css({
      top: 25,
      left: 210,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('命中'));
    $(this.divObject).append($('<div>').addClass('field_hit_rate').css({
      top: 25,
      left: 260,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getHitRate()));
    $(this.divObject).append($('<div>').addClass('label_dodge_rate').css({
      top: 45,
      left: 210,
      width: 90,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('回避'));
    $(this.divObject).append($('<div>').addClass('field_dodge_rate').css({
      top: 45,
      left: 260,
      width: 20,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getDodgeRate()));
    $(this.divObject).append($('<div>').addClass('label_move').css({
      top: 25,
      left: 310,
      width: 50,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('移動'));
    $(this.divObject).append($('<div>').addClass('field_move').css({
      top: 25,
      left: 360,
      width: 50,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getMove()));
    $(this.divObject).append($('<div>').addClass('label_range').css({
      top: 45,
      left: 310,
      width: 50,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('射程'));
    $(this.divObject).append($('<div>').addClass('field_range').css({
      top: 45,
      left: 360,
      width: 50,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getMove()));
    $(this.divObject).append($('<div>').addClass('label_ability').css({
      top: 85,
      left: 90,
      width: 50,
      height: 20,
      "font-size": "16px",
      "background-color": '#ffffff'
    }).html('能力'));
    return $(this.divObject).append($('<div>').addClass('field_ability').css({
      top: 85,
      left: 130,
      width: 250,
      height: 20,
      "font-size": "16px"
    }).html(this.object.getAbilityName()).tooltip({
      'placement': 'top',
      'title': this.object.getAbilityDesc()
    }));
  };

  return Panel;

})();

RightInfoManager = (function(superClass) {
  extend(RightInfoManager, superClass);

  function RightInfoManager() {
    return RightInfoManager.__super__.constructor.apply(this, arguments);
  }

  RightInfoManager.ID = 'right_info';

  return RightInfoManager;

})(InfoManager);

$().ready(function() {
  return GameManager.init();
});

Utl = (function() {
  function Utl() {}

  Utl.numFormat = function(num) {
    return String(num).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, '$1,');
  };

  Utl.rand = function(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  };

  Utl.genPassword = function(length) {
    var chars, i, j, ref, res;
    if (length == null) {
      length = 4;
    }
    chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    res = '';
    for (i = j = 0, ref = length; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
      res += chars.substr(this.rand(0, chars.length - 1), 1);
    }
    return res;
  };

  Utl.adrBar = function(url) {
    return window.history.replaceState('', '', '' + url);
  };

  Utl.getQuery = function(key, defaultValue) {
    var j, k, len, p, params, query, ref, res, v;
    if (key == null) {
      key = null;
    }
    if (defaultValue == null) {
      defaultValue = null;
    }
    query = document.location.search.substring(1);
    params = query.split('&');
    res = {};
    for (j = 0, len = params.length; j < len; j++) {
      p = params[j];
      ref = p.split('='), k = ref[0], v = ref[1];
      res[k] = v;
    }
    if (key === null) {
      return res;
    }
    if (res[key] != null) {
      return res[key];
    }
    return defaultValue;
  };

  Utl.normalize = function(num, min, max) {
    var range;
    if (min == null) {
      min = 0;
    }
    if (max == null) {
      max = 1;
    }
    range = Math.abs(max - min);
    if (num < min) {
      num += range * Math.ceil(Math.abs(num - min) / range);
    } else if (max <= num) {
      num -= range * (Math.floor(Math.abs(num - max) / range) + 1);
    }
    return num;
  };

  Utl.time = function(date) {
    if (date == null) {
      date = null;
    }
    if (date === null) {
      date = new Date();
    }
    return Math.floor(+date / 1000);
  };

  Utl.militime = function(date, getAsFloat) {
    if (date == null) {
      date = null;
    }
    if (getAsFloat == null) {
      getAsFloat = false;
    }
    if (date === null) {
      date = new Date();
    }
    return +date / (getAsFloat ? 1000 : 1);
  };

  Utl.dateStr = function(date, dateSep) {
    if (date == null) {
      date = null;
    }
    if (dateSep == null) {
      dateSep = '-';
    }
    if (date === null) {
      date = new Date();
    }
    return '' + this.zerofill(date.getFullYear(), 4) + dateSep + this.zerofill(date.getMonth() + 1, 2) + dateSep + this.zerofill(date.getDate(), 2);
  };

  Utl.datetimeStr = function(date, dateSep, timeSep, betweenSep) {
    if (date == null) {
      date = null;
    }
    if (dateSep == null) {
      dateSep = '-';
    }
    if (timeSep == null) {
      timeSep = ':';
    }
    if (betweenSep == null) {
      betweenSep = ' ';
    }
    if (date === null) {
      date = new Date();
    }
    return this.dateStr(date, dateSep) + betweenSep + this.zerofill(date.getHours(), 2) + timeSep + this.zerofill(date.getMinutes(), 2) + timeSep + this.zerofill(date.getSeconds(), 2);
  };

  Utl.difftime = function(targetDate, baseDate, nowSec, nowStr, agoStr, secStr, minStr, hourStr, dayStr, monStr, yearStr) {
    var baseTime, d, diffTime, h, m, mo, targetTime, y;
    if (baseDate == null) {
      baseDate = null;
    }
    if (nowSec == null) {
      nowSec = 0;
    }
    if (nowStr == null) {
      nowStr = 'ついさっき';
    }
    if (agoStr == null) {
      agoStr = '前';
    }
    if (secStr == null) {
      secStr = '秒';
    }
    if (minStr == null) {
      minStr = '分';
    }
    if (hourStr == null) {
      hourStr = '時間';
    }
    if (dayStr == null) {
      dayStr = '日';
    }
    if (monStr == null) {
      monStr = '月';
    }
    if (yearStr == null) {
      yearStr = '年';
    }
    if (baseDate === null) {
      baseTime = this.time();
    }
    targetTime = this.time(targetDate);
    diffTime = baseTime - targetTime;
    if (diffTime < 0) {
      return null;
    }
    if (nowSec >= diffTime) {
      return nowStr;
    }
    y = Math.floor(diffTime / (60 * 60 * 24 * 30 * 12));
    if (y > 0) {
      return '' + y + yearStr + agoStr;
    }
    diffTime -= y * (60 * 60 * 24 * 30 * 12);
    mo = Math.floor(diffTime / (60 * 60 * 24 * 30));
    if (mo > 0) {
      return '' + mo + monStr + agoStr;
    }
    diffTime -= mo * (60 * 60 * 24 * 30);
    d = Math.floor(diffTime / (60 * 60 * 24));
    if (d > 0) {
      return '' + d + dayStr + agoStr;
    }
    diffTime -= d * (60 * 60 * 24);
    h = Math.floor(diffTime / (60 * 60));
    if (h > 0) {
      return '' + h + hourStr + agoStr;
    }
    diffTime -= h * (60 * 60);
    m = Math.floor(diffTime / 60);
    if (m > 0) {
      return '' + m + minStr + agoStr;
    }
    diffTime -= m * 60;
    if (diffTime > 0) {
      return '' + diffTime + secStr + agoStr;
    }
    return nowStr;
  };

  Utl.zerofill = function(num, digit) {
    return ('' + this.repeat('0', digit) + num).slice(-digit);
  };

  Utl.repeat = function(str, times) {
    return Array(1 + times).join(str);
  };

  Utl.shuffle = function(ary) {
    var i, n, ref;
    n = ary.length;
    while (n) {
      n--;
      i = this.rand(0, n);
      ref = [ary[n], ary[i]], ary[i] = ref[0], ary[n] = ref[1];
    }
    return ary;
  };

  Utl.inArray = function(needle, ary) {
    var j, len, v;
    for (j = 0, len = ary.length; j < len; j++) {
      v = ary[j];
      if (v === needle) {
        return true;
      }
    }
    return false;
  };

  Utl.clone = function(obj) {
    var res;
    res = obj;
    if ($.isArray(obj)) {
      res = $.extend(true, [], obj);
    } else if (obj instanceof Object) {
      res = $.extend(true, {}, obj);
    }
    return res;
  };

  Utl.arrayFill = function(length, val) {
    var i, j, ref, res;
    if (val == null) {
      val = null;
    }
    res = [];
    for (i = j = 0, ref = length; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
      res[i] = this.clone(val);
    }
    return res;
  };

  Utl.array2dFill = function(x, y, val) {
    var j, l, ref, ref1, res, xx, yAry, yy;
    if (y == null) {
      y = null;
    }
    if (val == null) {
      val = null;
    }
    if (y === null) {
      y = x;
    }
    res = [];
    yAry = [];
    for (yy = j = 0, ref = y; 0 <= ref ? j < ref : j > ref; yy = 0 <= ref ? ++j : --j) {
      yAry[yy] = this.clone(val);
    }
    for (xx = l = 0, ref1 = x; 0 <= ref1 ? l < ref1 : l > ref1; xx = 0 <= ref1 ? ++l : --l) {
      res[xx] = this.clone(yAry);
    }
    return res;
  };

  Utl.arraySum = function(ary) {
    var j, len, sum, v;
    sum = 0;
    for (j = 0, len = ary.length; j < len; j++) {
      v = ary[j];
      sum += v;
    }
    return sum;
  };

  Utl.arrayMin = function(ary) {
    var j, len, min, v;
    min = null;
    for (j = 0, len = ary.length; j < len; j++) {
      v = ary[j];
      if (min === null || min > v) {
        min = v;
      }
    }
    return min;
  };

  Utl.arrayMax = function(ary) {
    var j, len, max, v;
    max = null;
    for (j = 0, len = ary.length; j < len; j++) {
      v = ary[j];
      if (max === null || max < v) {
        max = v;
      }
    }
    return max;
  };

  Utl.count = function(object) {
    return Object.keys(object).length;
  };

  Utl.uuid4 = function() {
    var i, j, random, uuid;
    uuid = '';
    for (i = j = 0; j < 32; i = ++j) {
      random = Math.random() * 16 | 0;
      if (i === 8 || i === 12 || i === 16 || i === 20) {
        uuid += '-';
      }
      uuid += (i === 12 ? 4 : (i === 16 ? random & 3 | 8 : random)).toString(16);
    }
    return uuid;
  };

  Utl.delLs = function(key) {
    return localStorage.removeItem(key);
  };

  Utl.setLs = function(key, value) {
    var json;
    if (value == null) {
      value = null;
    }
    if (value === null) {
      return this.delLs(key);
    }
    json = JSON.stringify(value);
    return localStorage.setItem(key, json);
  };

  Utl.getLs = function(key) {
    var res;
    res = localStorage.getItem(key);
    try {
      res = JSON.parse(res);
    } catch (error) {
      res = null;
    }
    return res;
  };

  Utl.getOnWheel = function() {
    if ('onwheel' in document) {
      return 'wheel';
    }
    if ('onmousewheel' in document) {
      return 'mousewheel';
    }
    return 'DOMMouseScroll';
  };

  Utl.e2localPos = function(e) {
    var boundingClientRect;
    boundingClientRect = e.currentTarget.getBoundingClientRect();
    return [e.clientX - boundingClientRect.left, e.clientY - boundingClientRect.top];
  };

  Utl.dumpNumArray2d = function(ary) {
    var j, l, ref, ref1, res, x, y;
    res = '';
    for (y = j = 0, ref = ary[0].length; 0 <= ref ? j < ref : j > ref; y = 0 <= ref ? ++j : --j) {
      for (x = l = 0, ref1 = ary.length; 0 <= ref1 ? l < ref1 : l > ref1; x = 0 <= ref1 ? ++l : --l) {
        if (ary[x][y] === null) {
          res += '-';
        } else if (ary[x][y] === 10) {
          res += 'A';
        } else if (ary[x][y] === 11) {
          res += 'B';
        } else if (ary[x][y] === 12) {
          res += 'C';
        } else if (ary[x][y] === 13) {
          res += 'D';
        } else if (ary[x][y] === 14) {
          res += 'E';
        } else if (ary[x][y] === 15) {
          res += 'F';
        } else if (ary[x][y] === 16) {
          res += 'G';
        } else if (ary[x][y] === 17) {
          res += 'H';
        } else {
          res += '' + ary[x][y];
        }
      }
      res += "\n";
    }
    return console.log(res);
  };

  Utl.gacha = function(map) {
    var j, l, len, len1, p, pTotal, ref, ref1, seed, target;
    if (map.length <= 0) {
      return false;
    }
    pTotal = 0;
    for (j = 0, len = map.length; j < len; j++) {
      ref = map[j], target = ref[0], p = ref[1];
      pTotal += p;
    }
    if (pTotal <= 0) {
      return false;
    }
    seed = Utl.rand(1, pTotal);
    pTotal = 0;
    for (l = 0, len1 = map.length; l < len1; l++) {
      ref1 = map[l], target = ref1[0], p = ref1[1];
      pTotal += p;
      if (seed <= pTotal) {
        return target;
      }
    }
    return map[map.legnth - 1][0];
  };

  return Utl;

})();

LevelupManager = (function() {
  function LevelupManager() {}

  LevelupManager.ID = 'levelup';

  LevelupManager.SIZE_X = 1050;

  LevelupManager.SIZE_Y = 600;

  LevelupManager.init = function(parentElement) {
    this.parentElement = parentElement;
    this.divObject = $('<div>').attr('id', this.ID).css({
      width: this.SIZE_X,
      height: this.SIZE_Y
    }).appendTo(this.parentElement);
    return this.characters = [];
  };

  LevelupManager.addCharacter = function(characterObject) {
    this.characters.push(characterObject);
    return this.draw();
  };

  LevelupManager.draw = function() {
    var c, index, j, len, ref, results, top;
    this.characters.sort(function(a, b) {
      return Number(a.getId()) - Number(b.getId());
    });
    this.panels = [];
    $('#' + this.ID + ' > .' + LevelupPanel.CLASSNAME).remove();
    ref = this.characters;
    results = [];
    for (index = j = 0, len = ref.length; j < len; index = ++j) {
      c = ref[index];
      top = index * LevelupPanel.SIZE_Y;
      results.push(this.panels.push(new LevelupPanel(this.divObject, c, top)));
    }
    return results;
  };

  LevelupManager.show = function() {
    return this.divObject.addClass('no_display');
  };

  LevelupManager.hide = function() {
    return this.divObject.addClass('no_display');
  };

  return LevelupManager;

})();

LevelupController = (function() {
  LevelupController.CLASSNAME = 'levelup_controller';

  LevelupController.SIZE_X = 200;

  LevelupController.SIZE_Y = 120;

  LevelupController.POS_X = Panel.SIZE_X;

  LevelupController.POS_Y = 0;

  function LevelupController(parentLevelupPanel) {
    this.parentLevelupPanel = parentLevelupPanel;
    this.divObject = $('<div>').addClass(this.constructor.CLASSNAME).css({
      width: this.constructor.SIZE_X,
      height: this.constructor.SIZE_Y,
      top: this.constructor.POS_Y,
      left: this.constructor.POS_X,
      'background-color': '#ffffff'
    });
    this.input = $('<input>').attr({
      type: 'range',
      min: 1,
      max: this.parentLevelupPanel.object.getLevelUpMax(EnvManager.getExp()),
      step: 1
    }).addClass('levelup_range').css({
      width: '' + (this.constructor.SIZE_X - 20) + 'px'
    }).on('mousemove', this.onChange.bind(this)).val(1).appendTo(this.divObject);
    this.expLabel = $('<div>').addClass('levelup_exp_label').html('EXP').appendTo(this.divObject);
    this.expNum = $('<div>').addClass('levelup_exp').appendTo(this.divObject);
    this.levelButton = $('<button>').addClass('levelup_level_button').css({
      width: 200
    }).on('click', this.onLevelup.bind(this)).appendTo(this.divObject);
    this.onChange();
    this.divObject.appendTo(this.parentLevelupPanel.divObject);
  }

  LevelupController.prototype.onChange = function() {
    var levelup, neededExp;
    levelup = Number(this.input.val());
    neededExp = this.parentLevelupPanel.object.getNeededExp(levelup);
    this.levelButton.html(levelup + 'レベルUP');
    this.expNum.html(neededExp);
    if (EnvManager.getExp() < neededExp) {
      this.levelButton.prop('disabled', true);
    }
    return this.parentLevelupPanel.setLevel(levelup);
  };

  LevelupController.prototype.onLevelup = function() {
    var levelup, neededExp;
    GameManager.changeControllable(false);
    levelup = Number(this.input.val());
    neededExp = this.parentLevelupPanel.object.getNeededExp(levelup);
    if (EnvManager.decreaseExp(neededExp) === false) {
      return;
    }
    this.parentLevelupPanel.object.levelup(levelup);
    LevelupManager.draw();
    CharacterPalletManager.draw();
    return GameManager.changeControllable(true);
  };

  return LevelupController;

})();

LevelupPanel = (function() {
  LevelupPanel.SIZE_X = Panel.SIZE_X * 2 + 200;

  LevelupPanel.SIZE_Y = 120;

  LevelupPanel.CLASSNAME = 'levelup_panel';

  function LevelupPanel(parentElement, object1, posY, posX) {
    this.parentElement = parentElement;
    this.object = object1;
    this.posY = posY != null ? posY : 0;
    this.posX = posX != null ? posX : 0;
    this.divObject = $('<div>').addClass(this.constructor.CLASSNAME).css({
      width: this.constructor.SIZE_X,
      height: this.constructor.SIZE_Y,
      top: this.posY,
      left: this.posX
    }).appendTo(this.parentElement);
    this.draw();
  }

  LevelupPanel.prototype.draw = function() {
    $(this.divObject).find('*').remove();
    this.leftPanel = new Panel(this.divObject, this.object, 0, 0);
    this.rightPanel = new Panel(this.divObject, this.object, 0, Panel.SIZE_X + 200);
    return this.centerController = new LevelupController(this, this.divObject);
  };

  LevelupPanel.prototype.setLevel = function(levelup) {
    return this.rightPanel.draw(this.object.getLevel() + levelup);
  };

  return LevelupPanel;

})();

EnvManager = (function() {
  function EnvManager() {}

  EnvManager.ID = 'env';

  EnvManager.SIZE_X = 200;

  EnvManager.SIZE_Y = 120;

  EnvManager.exp = 0;

  EnvManager.floor = 1;

  EnvManager.life = 5;

  EnvManager.init = function(parentElement) {
    this.parentElement = parentElement;
    this.divObject = $('<div>').attr('id', this.ID).css({
      width: this.SIZE_X,
      height: this.SIZE_Y
    });
    this.lifeObject = $('<div>').css({
      left: 0,
      top: 2,
      height: 35,
      width: this.SIZE_X - 10
    }).appendTo(this.divObject);
    this.expObject = $('<div>').css({
      left: 0,
      top: 40,
      height: 35,
      width: this.SIZE_X - 10
    }).appendTo(this.divObject);
    this.floorObject = $('<div>').css({
      left: 0,
      top: 77,
      height: 35,
      width: this.SIZE_X - 10
    }).appendTo(this.divObject);
    this.draw();
    return this.divObject.appendTo(this.parentElement);
  };

  EnvManager.draw = function() {
    this.lifeObject.html('&#9829;' + this.life);
    this.expObject.html('EXP:' + this.exp);
    return this.floorObject.html('' + this.floor + '階');
  };

  EnvManager.increaseExp = function(amount) {
    if (amount < 1) {
      return false;
    }
    this.exp += amount;
    this.draw();
    return this.exp;
  };

  EnvManager.decreaseExp = function(amount) {
    if (amount < 1) {
      return false;
    }
    if (this.exp < amount) {
      return false;
    }
    this.exp -= amount;
    this.draw();
    return this.exp;
  };

  EnvManager.getExp = function() {
    return this.exp;
  };

  EnvManager.setExp = function(exp) {
    if (exp < 0) {
      return false;
    }
    this.exp = exp;
    this.draw();
    return this.exp;
  };

  EnvManager.increaseFloor = function(amount) {
    if (amount == null) {
      amount = 1;
    }
    if (amount < 1) {
      return false;
    }
    this.floor += amount;
    this.draw();
    return this.floor;
  };

  EnvManager.decreaseFloor = function(amount) {
    if (amount < 1) {
      return false;
    }
    if (this.floor - amount < 1) {
      return false;
    }
    this.floor -= amount;
    if (this.floor < 1) {
      this.floor = 1;
    }
    this.draw();
    return this.floor;
  };

  EnvManager.getFloor = function() {
    return this.floor;
  };

  EnvManager.setFloor = function(floor) {
    if (floor < 1) {
      return false;
    }
    this.floor = floor;
    this.draw();
    return this.floor;
  };

  EnvManager.increaseLife = function(amount) {
    if (amount == null) {
      amount = 1;
    }
    if (amount < 1) {
      return false;
    }
    this.life += amount;
    this.draw();
    return this.life;
  };

  EnvManager.decreaseLife = function(amount) {
    if (amount == null) {
      amount = 1;
    }
    if (amount < 1) {
      return false;
    }
    if (this.life < amount) {
      return false;
    }
    this.life -= amount;
    if (this.life < 0) {
      this.life = 0;
    }
    this.draw();
    return this.life;
  };

  EnvManager.getLife = function() {
    return this.life;
  };

  EnvManager.setLife = function(life) {
    if (life < 0) {
      return false;
    }
    this.life = life;
    this.draw();
    return this.life;
  };

  return EnvManager;

})();

SimamuraUdukiBase = (function(superClass) {
  extend(SimamuraUdukiBase, superClass);

  SimamuraUdukiBase.characterId = 1;

  SimamuraUdukiBase.characterName = "島村卯月";

  SimamuraUdukiBase.defaultJoin = true;

  SimamuraUdukiBase.images = ["./img/character/1/1.png", "./img/character/1/2.png"];

  SimamuraUdukiBase.attackTypeBase = ObjectBase.ATTACK_TYPE.PHYSIC;

  SimamuraUdukiBase.attackBase = 1;

  SimamuraUdukiBase.hpBase = 1;

  SimamuraUdukiBase.pDefBase = 1;

  SimamuraUdukiBase.mDefBase = 1;

  SimamuraUdukiBase.moveBase = 1;

  SimamuraUdukiBase.rangeBase = 1;

  SimamuraUdukiBase.hitRateBase = 1;

  SimamuraUdukiBase.dodgeRateBase = 1;

  SimamuraUdukiBase.itemMax = 1;

  SimamuraUdukiBase.expRate = 1;

  SimamuraUdukiBase.abilityName = "島村卯月の能力";

  SimamuraUdukiBase.abilityDesc = "島村卯月の説明";

  function SimamuraUdukiBase(params) {
    SimamuraUdukiBase.__super__.constructor.call(this, params);
  }

  return SimamuraUdukiBase;

})(CharacterBase);

ShibuyaRinBase = (function(superClass) {
  extend(ShibuyaRinBase, superClass);

  ShibuyaRinBase.characterId = 2;

  ShibuyaRinBase.characterName = "渋谷凛";

  ShibuyaRinBase.defaultJoin = true;

  ShibuyaRinBase.images = ["./img/character/2/1.png", "./img/character/2/2.png"];

  ShibuyaRinBase.attackTypeBase = ObjectBase.ATTACK_TYPE.PHYSIC;

  ShibuyaRinBase.attackBase = 2;

  ShibuyaRinBase.hpBase = 2;

  ShibuyaRinBase.pDefBase = 2;

  ShibuyaRinBase.mDefBase = 2;

  ShibuyaRinBase.moveBase = 2;

  ShibuyaRinBase.rangeBase = 2;

  ShibuyaRinBase.hitRateBase = 2;

  ShibuyaRinBase.dodgeRateBase = 2;

  ShibuyaRinBase.itemMax = 2;

  ShibuyaRinBase.expRate = 2;

  ShibuyaRinBase.abilityName = "渋谷凛の能力";

  ShibuyaRinBase.abilityDesc = "渋谷凛の能力";

  function ShibuyaRinBase(params) {
    ShibuyaRinBase.__super__.constructor.call(this, params);
  }

  return ShibuyaRinBase;

})(CharacterBase);

HondaMioBase = (function(superClass) {
  extend(HondaMioBase, superClass);

  HondaMioBase.characterId = 3;

  HondaMioBase.characterName = "本田未央";

  HondaMioBase.defaultJoin = true;

  HondaMioBase.images = ["./img/character/3/1.png", "./img/character/3/2.png"];

  HondaMioBase.attackTypeBase = ObjectBase.ATTACK_TYPE.PHYSIC;

  HondaMioBase.attackBase = 3;

  HondaMioBase.hpBase = 3;

  HondaMioBase.pDefBase = 3;

  HondaMioBase.mDefBase = 3;

  HondaMioBase.moveBase = 3;

  HondaMioBase.rangeBase = 3;

  HondaMioBase.hitRateBase = 3;

  HondaMioBase.dodgeRateBase = 3;

  HondaMioBase.itemMax = 3;

  HondaMioBase.expRate = 3;

  HondaMioBase.abilityName = "本田未央の能力";

  HondaMioBase.abilityDesc = "本田未央のせつめい";

  function HondaMioBase(params) {
    HondaMioBase.__super__.constructor.call(this, params);
  }

  return HondaMioBase;

})(CharacterBase);

HondaMio = (function(superClass) {
  extend(HondaMio, superClass);

  function HondaMio(params) {
    HondaMio.__super__.constructor.call(this, params);
  }

  return HondaMio;

})(HondaMioBase);

ShibuyaRin = (function(superClass) {
  extend(ShibuyaRin, superClass);

  function ShibuyaRin(params) {
    ShibuyaRin.__super__.constructor.call(this, params);
  }

  return ShibuyaRin;

})(ShibuyaRinBase);

SimamuraUduki = (function(superClass) {
  extend(SimamuraUduki, superClass);

  function SimamuraUduki(params) {
    SimamuraUduki.__super__.constructor.call(this, params);
  }

  return SimamuraUduki;

})(SimamuraUdukiBase);

window.CharacterList = {
  "1": SimamuraUduki,
  "2": ShibuyaRin,
  "3": HondaMio
};

KeruberosuBase = (function(superClass) {
  extend(KeruberosuBase, superClass);

  KeruberosuBase.characterId = 1;

  KeruberosuBase.characterName = "きゃんきゃん";

  KeruberosuBase.images = ["./img/enemy/1/1005010301_001.png", "./img/enemy/1/1005010301_002.png", "./img/enemy/1/1005010301_003.png"];

  KeruberosuBase.attackTypeBase = ObjectBase.ATTACK_TYPE.PHYSIC;

  KeruberosuBase.attackBase = 18;

  KeruberosuBase.hpBase = 3;

  KeruberosuBase.pDefBase = 1;

  KeruberosuBase.mDefBase = 3;

  KeruberosuBase.moveBase = 4;

  KeruberosuBase.rangeBase = 1;

  KeruberosuBase.hitRateBase = 95;

  KeruberosuBase.dodgeRateBase = 10;

  KeruberosuBase.appearance = 1;

  KeruberosuBase.expRate = 2;

  KeruberosuBase.abilityName = "なし";

  KeruberosuBase.abilityDesc = "なし";

  function KeruberosuBase(params) {
    KeruberosuBase.__super__.constructor.call(this, params);
  }

  return KeruberosuBase;

})(EnemyBase);

MeatballBase = (function(superClass) {
  extend(MeatballBase, superClass);

  MeatballBase.characterId = 2;

  MeatballBase.characterName = "ミートボール";

  MeatballBase.images = ["./img/enemy/2/1036010301_001.png", "./img/enemy/2/1036010301_002.png", "./img/enemy/2/1036010301_003.png"];

  MeatballBase.attackTypeBase = ObjectBase.ATTACK_TYPE.PHYSIC;

  MeatballBase.attackBase = 17;

  MeatballBase.hpBase = 2;

  MeatballBase.pDefBase = 1;

  MeatballBase.mDefBase = 3;

  MeatballBase.moveBase = 4;

  MeatballBase.rangeBase = 1;

  MeatballBase.hitRateBase = 95;

  MeatballBase.dodgeRateBase = 10;

  MeatballBase.appearance = 1;

  MeatballBase.expRate = 2;

  MeatballBase.abilityName = "なし";

  MeatballBase.abilityDesc = "なし";

  function MeatballBase(params) {
    MeatballBase.__super__.constructor.call(this, params);
  }

  return MeatballBase;

})(EnemyBase);

PixyFoxBase = (function(superClass) {
  extend(PixyFoxBase, superClass);

  PixyFoxBase.characterId = 3;

  PixyFoxBase.characterName = "ピクシーFOX";

  PixyFoxBase.images = ["./img/enemy/3/1082010301_001.png", "./img/enemy/3/1082010301_002.png", "./img/enemy/3/1082010301_003.png"];

  PixyFoxBase.attackTypeBase = ObjectBase.ATTACK_TYPE.PHYSIC;

  PixyFoxBase.attackBase = 18;

  PixyFoxBase.hpBase = 3;

  PixyFoxBase.pDefBase = 6;

  PixyFoxBase.mDefBase = 4;

  PixyFoxBase.moveBase = 4;

  PixyFoxBase.rangeBase = 1;

  PixyFoxBase.hitRateBase = 95;

  PixyFoxBase.dodgeRateBase = 10;

  PixyFoxBase.appearance = 1;

  PixyFoxBase.expRate = 2;

  PixyFoxBase.abilityName = "なし";

  PixyFoxBase.abilityDesc = "なし";

  function PixyFoxBase(params) {
    PixyFoxBase.__super__.constructor.call(this, params);
  }

  return PixyFoxBase;

})(EnemyBase);

MajisukoBase = (function(superClass) {
  extend(MajisukoBase, superClass);

  MajisukoBase.characterId = 4;

  MajisukoBase.characterName = "マジスコ";

  MajisukoBase.images = ["./img/enemy/4/1084010301_001.png", "./img/enemy/4/1084010301_002.png", "./img/enemy/4/1084010301_003.png"];

  MajisukoBase.attackTypeBase = ObjectBase.ATTACK_TYPE.MAGIC;

  MajisukoBase.attackBase = 19;

  MajisukoBase.hpBase = 3;

  MajisukoBase.pDefBase = 7;

  MajisukoBase.mDefBase = 4;

  MajisukoBase.moveBase = 3;

  MajisukoBase.rangeBase = 4;

  MajisukoBase.hitRateBase = 95;

  MajisukoBase.dodgeRateBase = 10;

  MajisukoBase.appearance = 1;

  MajisukoBase.expRate = 2;

  MajisukoBase.abilityName = "なし";

  MajisukoBase.abilityDesc = "なし";

  function MajisukoBase(params) {
    MajisukoBase.__super__.constructor.call(this, params);
  }

  return MajisukoBase;

})(EnemyBase);

BakudaniwaBase = (function(superClass) {
  extend(BakudaniwaBase, superClass);

  BakudaniwaBase.characterId = 5;

  BakudaniwaBase.characterName = "ばくだんいわ";

  BakudaniwaBase.images = ["./img/enemy/5/1.png"];

  BakudaniwaBase.attackTypeBase = ObjectBase.ATTACK_TYPE.PHYSIC;

  BakudaniwaBase.attackBase = 0;

  BakudaniwaBase.hpBase = 3;

  BakudaniwaBase.pDefBase = 8;

  BakudaniwaBase.mDefBase = 8;

  BakudaniwaBase.moveBase = 0;

  BakudaniwaBase.rangeBase = 0;

  BakudaniwaBase.hitRateBase = 95;

  BakudaniwaBase.dodgeRateBase = 10;

  BakudaniwaBase.appearance = 1;

  BakudaniwaBase.expRate = 2;

  BakudaniwaBase.abilityName = "なし";

  BakudaniwaBase.abilityDesc = "なし";

  function BakudaniwaBase(params) {
    BakudaniwaBase.__super__.constructor.call(this, params);
  }

  return BakudaniwaBase;

})(EnemyBase);

Bakudaniwa = (function(superClass) {
  extend(Bakudaniwa, superClass);

  function Bakudaniwa(params) {
    Bakudaniwa.__super__.constructor.call(this, params);
  }

  return Bakudaniwa;

})(BakudaniwaBase);

Keruberosu = (function(superClass) {
  extend(Keruberosu, superClass);

  function Keruberosu(params) {
    Keruberosu.__super__.constructor.call(this, params);
  }

  return Keruberosu;

})(KeruberosuBase);

Majisuko = (function(superClass) {
  extend(Majisuko, superClass);

  function Majisuko(params) {
    Majisuko.__super__.constructor.call(this, params);
  }

  return Majisuko;

})(MajisukoBase);

Meatball = (function(superClass) {
  extend(Meatball, superClass);

  function Meatball(params) {
    Meatball.__super__.constructor.call(this, params);
  }

  return Meatball;

})(MeatballBase);

PixyFox = (function(superClass) {
  extend(PixyFox, superClass);

  function PixyFox(params) {
    PixyFox.__super__.constructor.call(this, params);
  }

  return PixyFox;

})(PixyFoxBase);

window.EnemyList = {
  "1": Keruberosu,
  "2": Meatball,
  "3": PixyFox,
  "4": Majisuko,
  "5": Bakudaniwa
};
